<section class="jobs-section">
  <div class="section-header">
    <h2>
      Your Job <span class="highlight">{{ jobCategory }}</span>
    </h2>
    <p>Track all your job opportunities in one place</p>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-overlay active">
    <div class="spinner"></div>
  </div>

  <!-- Error State -->
  <div *ngIf="errorMessage" class="error-message">
    {{ errorMessage }}
  </div>

  <!-- Status Tabs -->
  <div class="status-tabs">
    <button
      *ngFor="let status of statuses"
      [class.active]="activeStatus === status"
      (click)="setActiveStatus(status)"
    >
      {{ status | titlecase }}
    </button>
  </div>
  <div class="search-filter-container">
    <!-- search bar -->
    <div class="search-container">
      <div class="search-bar">
        <mat-form-field appearance="outline" class="search-field white-outline">
          <mat-label>Search {{ jobCategory }}</mat-label>
          <input
            matInput
            type="text"
            [value]="searchQuery"
            (input)="onSearchInput($event)"
            (keyup.enter)="onSearch()"
            placeholder="Search by job title, company, location..."
          />
        </mat-form-field>
        <button
          mat-raised-button
          color="primary"
          (click)="onSearch()"
          class="search-button"
        >
          <mat-icon *ngIf="!searchLoading" class="search-icon" matSuffix
            >search</mat-icon
          >
          <div class="white-spinner">
            <mat-spinner *ngIf="searchLoading" diameter="25"></mat-spinner>
          </div>
        </button>
      </div>
    </div>
    <!-- Filter Controls -->
    <div class="filter-controls">
      <!-- Job Type Filter -->
      <mat-form-field appearance="outline" class="filter-field custom-outline">
        <mat-label>Job Type</mat-label>
        <mat-select
          [(value)]="jobTypeFilter"
          (selectionChange)="onFilterChange()"
        >
          <mat-option value="">All Types</mat-option>
          <mat-option value="remote">Remote</mat-option>
          <mat-option value="onsite">On-site</mat-option>
          <mat-option value="hybrid">Hybrid</mat-option>
        </mat-select>
      </mat-form-field>

      <!-- Industry Filter -->
      <mat-form-field appearance="outline" class="filter-field custom-outline">
        <mat-label>Industry</mat-label>
        <mat-select
          [(value)]="industryFilter"
          (selectionChange)="onFilterChange()"
        >
          <mat-option value="">All Industries</mat-option>
          <mat-option *ngFor="let industry of industries" [value]="industry">
            {{ industry || "All Industries" }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <div class="date-picker-container">
        <!-- Date Filter -->
        <mat-form-field
          appearance="outline"
          class="filter-field custom-outline"
        >
          <mat-label>Date Posted</mat-label>
          <mat-select
            [(value)]="dateFilter"
            (selectionChange)="onFilterChange()"
          >
            <mat-option
              *ngFor="let filter of dateFilters"
              [value]="filter.value"
            >
              {{ filter.label }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <!-- Custom Date Range (shown only when custom is selected) -->
        <div *ngIf="dateFilter === 'custom'" class="date-range-container">
          <mat-form-field appearance="outline" class="date-field date-white-outline">
            <mat-label>From</mat-label>
            <input
              matInput
              [matDatepicker]="startPicker"
              [(ngModel)]="startDate"
              (dateChange)="onDateRangeChange()"
            />
            <mat-datepicker-toggle
              matSuffix
              [for]="startPicker"
              class="search-icon"
            ></mat-datepicker-toggle>
            <mat-datepicker #startPicker></mat-datepicker>
          </mat-form-field>

          <mat-form-field appearance="outline" class="date-field date-white-outline">
            <mat-label>To</mat-label>
            <input
              matInput
              [matDatepicker]="endPicker"
              [(ngModel)]="endDate"
              (dateChange)="onDateRangeChange()"
            />
            <mat-datepicker-toggle
              matSuffix
              [for]="endPicker"
              class="search-icon"
            ></mat-datepicker-toggle>
            <mat-datepicker #endPicker></mat-datepicker>
          </mat-form-field>
        </div>
      </div>
    </div>
  </div>

  <!-- Job Cards Grid -->
  <div class="jobs-grid" *ngIf="activeStatus === 'offer'; else nonOfferJobs">
    <div
      *ngFor="let job of filteredJobs[activeStatus]"
      class="job-card"
      cdkDrag
    >
      <div class="job-badge">{{ job.type }}</div>
      <div class="job-content">
        <div class="company-logo">
          <img
            [src]="
              job?.company?.logo_url ||
              'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSlm0t5PrvJkY1Mnh8pMH1l0eTXgTbvLetn7g&s'
            "
            [alt]="job.company?.name + ' logo'"
          />
        </div>
        <div class="job-info">
          <h3>{{ job.title }}</h3>
          <p class="company">{{ job.company?.name }}</p>
          <div class="job-meta">
            <span class="location">
              <mat-icon>location_on</mat-icon>
              {{ job.location }}
            </span>
            <span class="salary">
              <mat-icon>attach_money</mat-icon>
              {{ job.salary || "Negotiable" }}
            </span>
            <span class="deadline" *ngIf="job.deadline">
              <mat-icon>event</mat-icon>
              {{ job.deadline | date }}
            </span>
          </div>
        </div>
      </div>
      <div class="job-footer">
        <span *ngIf="job.created_at" class="posted-date">
          Posted {{ job.created_at | dateAgo }}
        </span>
        <div class="job-actions">
          <button
            mat-stroked-button
            class="view-button"
            [routerLink]="['/job-offers', job.id]"
          >
            View
          </button>
          <button
            mat-stroked-button
            class="view-button"
            *ngIf="isJobCreator(job)"
            [routerLink]="['/jobs', job.id, 'applications']"
          >
            Applications
          </button>
        </div>
      </div>
    </div>
  </div>

  <ng-template #nonOfferJobs>
    <div *ngIf="activeStatus === 'applied'; else interviewJobs">
      <div class="jobs-grid" *ngIf="appliedJobs?.length; else noJobs">
        <div *ngFor="let job of appliedJobs" class="job-card">
          <div class="job-badge">{{ job.type }}</div>
          <div class="job-content">
            <div class="company-logo">
              <img
                [src]="job?.company?.logo_url || 'default-logo.png'"
                [alt]="job.company?.name + ' logo'"
              />
            </div>
            <div class="job-info">
              <h3>{{ job.title }}</h3>
              <p class="company">{{ job.company?.name }}</p>
              <div class="application-status">
                <span
                  class="status-badge"
                  [class.pending]="job.application_status === 'pending'"
                  [class.reviewed]="job.application_status === 'reviewed'"
                  [class.accepted]="job.application_status === 'accepted'"
                  [class.rejected]="job.application_status === 'rejected'"
                >
                  {{ job.application_status | titlecase }}
                </span>
              </div>
              <div class="job-meta">
                <span class="location">
                  <mat-icon>location_on</mat-icon>
                  {{ job.location }}
                </span>
                <span class="salary">
                  <mat-icon>attach_money</mat-icon>
                  {{ job.salary || "Negotiable" }}
                </span>
                <span class="deadline" *ngIf="job.deadline">
                  <mat-icon>event</mat-icon>
                  {{ job.deadline | date }}
                </span>
              </div>
            </div>
          </div>
          <div class="job-footer">
            <span class="posted-date">
              Applied {{ job.applied_at | dateAgo }}
            </span>
            <div class="job-actions">
              <button
                mat-stroked-button
                class="view-button"
                [routerLink]="['/job-offers', job.id]"
              >
                View Job
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </ng-template>

  <ng-template #interviewJobs>
    <!-- Interview-specific content -->
    <div class="jobs-grid" *ngIf="interviews?.length; else noJobs">
      <div *ngFor="let interview of interviews" class="job-card interview-card">
        <div class="job-badge interview-badge">
          <mat-icon>calendar_today</mat-icon>
          Interview
        </div>

        <div class="job-content">
          <div class="company-logo">
            <img
              [src]="
                interview?.job_offer?.company?.logo_url ||
                'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSlm0t5PrvJkY1Mnh8pMH1l0eTXgTbvLetn7g&s'
              "
              [alt]="interview.job_offer.company.name + ' logo'"
            />
          </div>

          <div class="job-info">
            <h3>{{ interview.job_offer.title }}</h3>
            <p class="company">{{ interview.job_offer.company.name }}</p>

            <div class="interview-details">
              <div class="detail-item">
                <mat-icon>schedule</mat-icon>
                <span>{{ interview.scheduled_time | date : "medium" }}</span>
              </div>
              <div class="detail-item">
                <mat-icon>location_on</mat-icon>
                <span>{{ interview.location || "Online" }}</span>
              </div>
            </div>
          </div>
        </div>

        <div class="job-footer">
          <div class="job-actions">
            <button
              mat-stroked-button
              class="view-button"
              [routerLink]="['/job-offers', interview.job_offer.id]"
            >
              View Job
            </button>
          </div>
        </div>
      </div>
    </div>
  </ng-template>

  <!-- Add this after your job cards grid, before the section-footer -->
  <div
    class="pagination-controls"
    *ngIf="activeStatus === 'offer' && totalPages > 1"
  >
    <div class="pagination-info">
      {{ paginationInfo }}
    </div>

    <div class="pagination-buttons">
      <button
        mat-stroked-button
        (click)="previousPage()"
        [disabled]="currentPage === 1"
        class="pagination-button"
      >
        Previous
      </button>

      <div class="page-numbers">
        <button
          *ngFor="let page of [].constructor(totalPages); let i = index"
          mat-stroked-button
          (click)="goToPage(i + 1)"
          [class.active]="currentPage === i + 1"
          class="page-button"
        >
          {{ i + 1 }}
        </button>
      </div>

      <button
        mat-stroked-button
        (click)="nextPage()"
        [disabled]="currentPage === totalPages"
        class="pagination-button"
      >
        Next
      </button>
    </div>
  </div>

  <!-- Add this inside the applied jobs section -->
  <div
    class="pagination-controls"
    *ngIf="activeStatus === 'applied' && appliedTotalPages > 1"
  >
    <div class="pagination-info">
      {{ appliedPaginationInfo }}
    </div>

    <div class="pagination-buttons">
      <button
        mat-stroked-button
        (click)="previousAppliedPage()"
        [disabled]="appliedCurrentPage === 1"
        class="pagination-button"
      >
        Previous
      </button>

      <div class="page-numbers">
        <button
          *ngFor="let page of [].constructor(appliedTotalPages); let i = index"
          mat-stroked-button
          (click)="goToAppliedPage(i + 1)"
          [class.active]="appliedCurrentPage === i + 1"
          class="page-button"
        >
          {{ i + 1 }}
        </button>
      </div>

      <button
        mat-stroked-button
        (click)="nextAppliedPage()"
        [disabled]="appliedCurrentPage === appliedTotalPages"
        class="pagination-button"
      >
        Next
      </button>
    </div>
  </div>

  <!-- Add this inside the interviews section -->
  <div
    class="pagination-controls"
    *ngIf="activeStatus === 'interview' && interviewsTotalPages > 1"
  >
    <div class="pagination-info">
      {{ interviewsPaginationInfo }}
    </div>

    <div class="pagination-buttons">
      <button
        mat-stroked-button
        (click)="previousInterviewsPage()"
        [disabled]="interviewsCurrentPage === 1"
        class="pagination-button"
      >
        Previous
      </button>

      <div class="page-numbers">
        <button
          *ngFor="
            let page of [].constructor(interviewsTotalPages);
            let i = index
          "
          mat-stroked-button
          (click)="goToInterviewsPage(i + 1)"
          [class.active]="interviewsCurrentPage === i + 1"
          class="page-button"
        >
          {{ i + 1 }}
        </button>
      </div>

      <button
        mat-stroked-button
        (click)="nextInterviewsPage()"
        [disabled]="interviewsCurrentPage === interviewsTotalPages"
        class="pagination-button"
      >
        Next
      </button>
    </div>
  </div>

  <ng-template #noJobs>
    <div class="no-jobs-message">
      <mat-icon>work_outline</mat-icon>
      <p>No {{ activeStatus }} jobs found</p>
      <button mat-raised-button color="primary" routerLink="/job-offers/create">
        Add New Job Application
      </button>
    </div>
  </ng-template>
</section>
